version: '3.8'

services:
  # Node.js Application
  app:
    build: ./app
    command: npm start
    environment:
      # RDS environment variables provided by Elastic Beanstalk
      DB_HOST: ${RDS_HOSTNAME}
      DB_PORT: ${RDS_PORT}
      DB_NAME: ${RDS_DB_NAME}
      DB_USER: ${RDS_USERNAME}
      DB_PASSWORD: ${RDS_PASSWORD}
    # No volume mounts in production - using built image
    # Not exposing ports to host - only accessible through nginx

  # Nginx Reverse Proxy (production only)
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      # Mount healthd logs directory for Elastic Beanstalk monitoring
      - /var/log/nginx/healthd:/var/log/nginx/healthd
    depends_on:
      - app
